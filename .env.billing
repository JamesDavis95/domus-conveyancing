# STRIPE LIVE BILLING CONFIGURATION - STEP 36
# Production Stripe keys for live billing with Bacs DD and VAT support
# 
# ⚠️ SECURITY WARNING: These are LIVE keys that will charge real money!
# Only use in production environment with proper security measures.

# Stripe Live API Keys (LIVE mode - handles real payments)
STRIPE_SECRET_KEY=sk_live_YOUR_LIVE_SECRET_KEY_HERE
STRIPE_PUBLISHABLE_KEY=pk_live_YOUR_LIVE_PUBLISHABLE_KEY_HERE
STRIPE_WEBHOOK_SECRET=whsec_YOUR_LIVE_WEBHOOK_SECRET_HERE

# Stripe Product Price IDs (Create these in Stripe Dashboard)
STRIPE_PRICE_PRO=price_LIVE_PRO_MONTHLY_2900  # £29.00/month
STRIPE_PRICE_ENT=price_LIVE_ENTERPRISE_MONTHLY_9900  # £99.00/month

# VAT Configuration
VAT_RATE=0.20  # 20% UK VAT
VAT_REVERSE_CHARGE_COUNTRIES=GB,IE,FR,DE,ES,IT,NL,BE,AT,PT,FI,SE,DK,LU,CY,MT,SI,SK,EE,LV,LT,PL,CZ,HU,RO,BG,HR

# Billing Quotas per Plan
STARTER_QUOTA_PROPERTIES=5
STARTER_QUOTA_API_CALLS=100
STARTER_QUOTA_DOCS=5
STARTER_QUOTA_PACKS=1

PRO_QUOTA_PROPERTIES=50
PRO_QUOTA_API_CALLS=1000
PRO_QUOTA_DOCS=50
PRO_QUOTA_PACKS=10

ENTERPRISE_QUOTA_PROPERTIES=999999
ENTERPRISE_QUOTA_API_CALLS=10000
ENTERPRISE_QUOTA_DOCS=500
ENTERPRISE_QUOTA_PACKS=100

# Overage Handling
ALLOW_OVERAGES_PRO=true
ALLOW_OVERAGES_ENTERPRISE=true
OVERAGE_GRACE_PERIOD_DAYS=3

# Webhook Configuration
WEBHOOK_TIMEOUT_SECONDS=30
WEBHOOK_RETRY_ATTEMPTS=3

# Development/Testing Keys (for non-production environments)
# STRIPE_SECRET_KEY=sk_test_YOUR_TEST_SECRET_KEY_HERE
# STRIPE_PUBLISHABLE_KEY=pk_test_YOUR_TEST_PUBLISHABLE_KEY_HERE
# STRIPE_WEBHOOK_SECRET=whsec_YOUR_TEST_WEBHOOK_SECRET_HERE

# Security Configuration
LIVE_BILLING_ENABLED=true
REQUIRE_VAT_FOR_EU=true
ENABLE_BACS_DIRECT_DEBIT=true
FORCE_SCA_AUTHENTICATION=true

# Database Configuration for Billing
BILLING_DB_ENCRYPTION_KEY=your-256-bit-encryption-key-for-billing-data
BILLING_AUDIT_LOG_RETENTION_DAYS=2555  # 7 years for tax compliance

# Notification Configuration
BILLING_ALERTS_EMAIL=billing@yourdomain.com
FAILED_PAYMENT_ALERT_WEBHOOK=https://your-domain.com/alerts/payment-failed
QUOTA_WARNING_THRESHOLD=0.8  # Alert when 80% of quota used
QUOTA_CRITICAL_THRESHOLD=0.95  # Critical alert when 95% used

# Currency and Region Settings
DEFAULT_CURRENCY=gbp
SUPPORTED_CURRENCIES=gbp,eur,usd
DEFAULT_COUNTRY=GB
BILLING_TIMEZONE=Europe/London

# Legal and Compliance
GDPR_DATA_RETENTION_DAYS=2555  # 7 years for financial records
PCI_COMPLIANCE_MODE=strict
AUDIT_ALL_BILLING_EVENTS=true

# Customer Portal Configuration
CUSTOMER_PORTAL_RETURN_URL=https://your-domain.com/billing
ALLOW_PROMOTION_CODES=true
ENABLE_TAX_ID_COLLECTION=true

# Performance and Caching
BILLING_CACHE_TTL_SECONDS=300  # 5 minutes
STRIPE_API_VERSION=2023-10-16
CONCURRENT_WEBHOOK_PROCESSORS=5

# Testing and Validation
BILLING_TEST_MODE=false  # Set to true for testing with test keys
VALIDATE_BILLING_ON_STARTUP=true
HEALTHCHECK_STRIPE_CONNECTION=true

# Monitoring and Metrics
BILLING_METRICS_ENABLED=true
EXPORT_BILLING_METRICS_INTERVAL=3600  # 1 hour
BILLING_ERROR_TRACKING=true

# Backup and Recovery
BILLING_DATA_BACKUP_ENABLED=true
BILLING_BACKUP_FREQUENCY=daily
BILLING_BACKUP_RETENTION_DAYS=90

# =====================================
# SETUP INSTRUCTIONS
# =====================================
# 
# 1. Create Stripe Account and Enable Live Mode
#    - Go to https://dashboard.stripe.com
#    - Complete business verification
#    - Enable live mode
# 
# 2. Get Live API Keys
#    - Navigate to Developers > API Keys
#    - Copy Live Secret Key (sk_live_...)
#    - Copy Live Publishable Key (pk_live_...)
# 
# 3. Create Products and Prices
#    - Go to Products in Stripe Dashboard
#    - Create "Professional Plan" product
#    - Add monthly price of £29.00 (2900 pence)
#    - Create "Enterprise Plan" product  
#    - Add monthly price of £99.00 (9900 pence)
#    - Copy price IDs (price_...)
# 
# 4. Enable Payment Methods
#    - Go to Settings > Payment methods
#    - Enable Card payments
#    - Enable Bacs Direct Debit for UK
#    - Configure Instant verification
# 
# 5. Configure Webhooks
#    - Go to Developers > Webhooks
#    - Add endpoint: https://your-domain.com/api/billing/webhook
#    - Select events:
#      * checkout.session.completed
#      * invoice.paid
#      * invoice.payment_failed
#      * customer.subscription.updated
#      * customer.subscription.deleted
#    - Copy webhook secret (whsec_...)
# 
# 6. Enable VAT Collection
#    - Go to Settings > Tax
#    - Enable automatic tax calculation
#    - Configure VAT for EU countries
#    - Enable Tax ID collection
# 
# 7. Security Setup
#    - Enable Connect Express platform
#    - Configure 2FA for Stripe account
#    - Set up IP restrictions if needed
#    - Review webhook security settings
# 
# 8. Testing
#    - Use Stripe test mode first
#    - Test all payment flows
#    - Verify webhook delivery
#    - Test VAT calculation
#    - Verify Bacs DD setup
# 
# 9. Go Live Checklist
#    - Complete Stripe account verification
#    - Update environment variables
#    - Configure DNS for webhooks
#    - Set up monitoring alerts
#    - Test in production environment
#    - Monitor first transactions carefully
#
# =====================================